# 4ì¥

## Row

<div style="border: 2px solid #DC143C; border-radius: 15px; padding: 15px; background-color: #fff5f5;">
  <span style="font-size: 25px; font-weight: bold; color: #DC143C;">
    ğŸ“Œ íšŒê·€ ë¶„ì„
  </span><br><br>
  â— íšŒê·€ë¶„ì„ ëª¨ë¸ì„ ì ìš©í•˜ì—¬ í—ˆìœ„ë§¤ë¬¼ì„ ì°¾ì•„ë‚¼ ê²½ìš°, ì ìˆ˜ì œë¡œ ì¶”ë ¤ì§„ í—ˆìœ„ë§¤ë¬¼ê³¼ ë¬´ì—‡ì´ ê°™ê³ , ë¬´ì—‡ì´ ë‹¤ë¥¸ì§€ ë¹„êµê°€ëŠ¥ <br>  
  âœ” ì¢…ì†ë³€ìˆ˜: 'SalePrice' <br>
  âœ” ë…ë¦½ë³€ìˆ˜: 'OverallQual', 'OverallCond', 'GrLivArea', 'YearRemodAdd', 'RoomDensity', 'amenities'
  <br><br>
</div>

## Row {height=10%}
:::{.card}

ğŸ” **íšŒê·€ë¶„ì„ ì§„í–‰ê³¼ì •** <br>
1. ëª¨ë“  ë³€ìˆ˜ì˜ ì˜í–¥ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ **Ridge íšŒê·€ ì ìš©** <br>
2. ë°ì´í„°ë¥¼ ***í•™ìŠµìš© 80%, í…ŒìŠ¤íŠ¸ìš© 20%***ë¡œ ë¶„ë¦¬í•˜ê³ , **5-fold êµì°¨ ê²€ì¦** ìˆ˜í–‰ <br>
3. êµì°¨ ê²€ì¦ì„ í†µí•´ ëª¨ë¸ì˜ ì•ˆì •ì„±ì„ í™•ë³´í•˜ê³ , ë‹¤ì–‘í•œ ì •ê·œí™” ê°•ë„(Î±)ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ì—¬ ìµœì ì˜ ì˜ˆì¸¡ ì„±ëŠ¥ì„ ê°€ì§„ ëª¨ë¸ì„ ì„ íƒí•¨. <br>
4. ì„±ëŠ¥ í‰ê°€ ì§€í‘œë¡œ **'neg_mean_squared_error'(ìŒì˜ í‰ê·  ì œê³± ì˜¤ì°¨)**ë¥¼ ì‚¬ìš© <br>
5. Pythonì˜ scikit-learnì—ì„œëŠ” ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ì¢‹ì€ ëª¨ë¸ë¡œ í‰ê°€í•˜ëŠ” ê·œì¹™ì´ ìˆì–´ ì˜¤ì°¨ ì§€í‘œë¥¼ **ìŒìˆ˜í™”**í•˜ì—¬ ì‚¬ìš© <br>
6. í—ˆìœ„ë§¤ë¬¼ íŒë³„ì„ ìœ„í•´ ì‹¤ì œê°€ê²©ê³¼ ì˜ˆì¸¡ê°€ê²©ì˜ **ì°¨ì´(ì”ì°¨)**ë¥¼ ê³„ì‚°í•˜ê³ , **í•˜ìœ„ 2.8%(72/2579)**ë¥¼ í—ˆìœ„ë§¤ë¬¼ë¡œ ë¶„ë¥˜ <br>
7. ì ìˆ˜ì œì—ì„œ ë°œê²¬í•œ í—ˆìœ„ë§¤ë¬¼ ìˆ˜ì™€ ë™ì¼í•œ ë¹„ìœ¨ì„ ì ìš©í•˜ì—¬ ë‘ ë°©ë²•ë¡ ì˜ ê²°ê³¼ë¥¼ **ì§ì ‘ ë¹„êµ**í•  ìˆ˜ ìˆê²Œ í•¨ <br>
8. ê° **ê°€ê²© ìˆ˜ì¤€(Low, Mid, High)** ê·¸ë£¹ë³„ë¡œ ë³„ë„ì˜ ëª¨ë¸ì„ êµ¬ì¶•í•˜ì—¬ ê°€ê²©ëŒ€ë³„ íŠ¹ì„±ì„ ë°˜ì˜í•œ í—ˆìœ„ë§¤ë¬¼ íƒì§€ê°€ ê°€ëŠ¥í•˜ë„ë¡ í•¨.

:::

## {.tabset}

### Low ê·¸ë£¹ 

::: {.card} 

```{python}

import numpy as np
import pandas as pd
from sklearn.linear_model import RidgeCV
from sklearn.model_selection import train_test_split
from sklearn.metrics import r2_score, mean_squared_error
import plotly.express as px

# ì‚¬ìš©í•  6ê°œ í”¼ì²˜ì™€ íƒ€ê²Ÿ ì •ì˜
features = [
    'OverallQual',
    'OverallCond',
    'GrLivArea',
    'YearRemodAdd',
    'RoomDensity',
    'amenities'
]
target = 'SalePrice'

level = 'Low'
df_lvl = df[df['price_level'] == level].copy()

X = df_lvl[features]
y = df_lvl[target]
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

ridge = RidgeCV(alphas=np.logspace(-4, 1, 10), cv=5, scoring='neg_mean_squared_error')
ridge.fit(X_train, y_train)

# â€” ì˜ˆì¸¡ ë° ì”ì°¨ ê³„ì‚° â€”
df_lvl['predicted'] = ridge.predict(X)
df_lvl['residual']  = df_lvl['SalePrice'] - df_lvl['predicted']
thresh = df_lvl['residual'].quantile(72/2579)
df_lvl['ridge_flag'] = df_lvl['residual'] <= thresh


#â€” ì„¤ëª…ë ¥(RÂ²) ë° ìµœì  Î± ê³„ì‚°Â·ì¶œë ¥ â€”
r2    = r2_score(y, ridge.predict(X))
alpha = ridge.alpha_
print(f"ì„¤ëª…ë ¥ (RÂ²): {r2:.3f}")
print(f"ìµœì  Î± (alpha): {alpha:.3g}\n")


import plotly.express as px

def make_figure(df, level):
    # 1) scatter - ì‹¤ì œê°€ê²©(xì¶•)ê³¼ ì˜ˆì¸¡ê°€ê²©(yì¶•) ì„¤ì •
    fig = px.scatter(
        df,
        x='SalePrice',     
        y='predicted',     
        color='ridge_flag',
        color_discrete_map={True: 'purple', False: 'lightgray'},
        opacity=0.7,
        title=f"ì‹¤ì œê°€ê²© vs ì˜ˆì¸¡ê°€ê²© ({level}) - Ridge Regression",
        labels={
            'SalePrice': 'ì‹¤ì œê°€ê²©($)',
            'predicted': 'ì˜ˆì¸¡ê°€ê²©($)',
            'ridge_flag': 'í—ˆìœ„ë§¤ë¬¼ ì—¬ë¶€'
        }
    )
    
    # 2) ëŒ€ê°ì„  (y = x)
    mn = min(df['predicted'].min(), df['SalePrice'].min())
    mx = max(df['predicted'].max(), df['SalePrice'].max())
    fig.add_shape(
        type='line',
        x0=mn, y0=mn, x1=mx, y1=mx,
        line=dict(color='black', dash='dash')
    )
    
    # 3) ì¶• ì œëª© & 1:1 ë¹„ìœ¨ ê³ ì • ë° ë²”ë¡€ ê°œì„ 
    fig.update_layout(
        width=650,         
        height=600,
        margin=dict(l=80, r=60, t=80, b=80),
        xaxis=dict(
            title='ì‹¤ì œê°€ê²©',
            scaleanchor='y', 
            scaleratio=1,
            title_standoff=15
        ),
        yaxis=dict(
            title='ì˜ˆì¸¡ê°€ê²©',
            title_standoff=15
        ),
        # 4) ë²”ë¡€ ìœ„ì¹˜ì™€ í˜•ì‹ ê°œì„  ('itemname' ì†ì„± ì œê±°)
        legend=dict(
            title=None,  # ë²”ë¡€ ì œëª© ì œê±°
            yanchor="top",
            y=0.99,
            xanchor="left",
            x=0.01,
            bgcolor="rgba(255, 255, 255, 0.8)",
            bordercolor="Black",
            borderwidth=1,
            font=dict(size=12)
        )
    )
    
    # 5) ë²”ë¡€ í…ìŠ¤íŠ¸ ì§ì ‘ ì—…ë°ì´íŠ¸
    new_names = {'True': 'í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬', 'False': 'ì •ìƒ'}
    fig.for_each_trace(lambda t: t.update(name = new_names[t.name]))
    
    return fig

# ì‚¬ìš©
fig = make_figure(df_lvl, level)
fig
```


```{python}
# 1) í†µê³„ ê³„ì‚°
flagged = df_lvl[df_lvl['ridge_flag']]
total   = len(df_lvl)
count   = len(flagged)
pct     = count/total*100

```

âœ” ì „ì²´ ìƒ˜í”Œ ìˆ˜ : 662ê°œ
âœ” í—ˆìœ„ ë§¤ë¬¼ ìˆ˜ : 19ê°œ

#### í—ˆìœ„ë§¤ë¬¼ ëª©ë¡ (ì •ë ¬ ê¸°ì¤€ : residual)

```{python}
# 5) ëª©ë¡
flagged[['Neighborhood','SalePrice','predicted','residual']] \
    .sort_values('residual')
```

#### Low ê·¸ë£¹ í—ˆìœ„ë§¤ë¬¼ ìœ„ì¹˜ ì§€ë„

```{python}

# 1) í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬ë§Œ í•„í„°ë§ (ì´ë¯¸ flaggedì— ì €ì¥ë¨)
suspects = flagged.copy()

# 2) ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
center = {
    "lat": suspects["Latitude"].mean(),
    "lon": suspects["Longitude"].mean()
}

# 3) Mapbox ì‚°ì ë„ ê·¸ë¦¬ê¸°
fig = px.scatter_mapbox(
    suspects,
    lat="Latitude",
    lon="Longitude",
    hover_name="Neighborhood",
    hover_data=["SalePrice","predicted","residual"],
    labels={
        "Latitude": "ìœ„ë„",
        "Longitude": "ê²½ë„",
        "price_level": "ë™ë„¤ ê°€ê²© ìˆ˜ì¤€",
        "Neighborhood": "ì§€ì—­(ë™ë„¤)",
        "SalePrice": "ì‹¤ì œ ê°€ê²©($)",
        "predicted": "ì˜ˆì¸¡ ê°€ê²©($)",
        "residual": "ì”ì°¨(ì‹¤ì œ ê°€ê²© - ì˜ˆì¸¡ ê°€ê²©)"
    },
    color_discrete_sequence=["purple"],
    zoom=11,
    center=center,
    width=600,    # ìº”ë²„ìŠ¤ ê°€ë¡œ(px)
    height=600,    # ìº”ë²„ìŠ¤ ì„¸ë¡œ(px)
    mapbox_style="open-street-map",
)

fig
```

:::

### Mid ê·¸ë£¹

::: {.card}


```{python}

level = 'Mid'
df_lvl = df[df['price_level'] == level].copy()

X = df_lvl[features]
y = df_lvl[target]
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

ridge = RidgeCV(alphas=np.logspace(-4, 1, 10), cv=5, scoring='neg_mean_squared_error')
ridge.fit(X_train, y_train)

df_lvl['predicted'] = ridge.predict(X)
df_lvl['residual']  = df_lvl['SalePrice'] - df_lvl['predicted']
thresh = df_lvl['residual'].quantile(72/2579)
df_lvl['ridge_flag'] = df_lvl['residual'] <= thresh

#â€” ì„¤ëª…ë ¥(RÂ²) ë° ìµœì  Î± ê³„ì‚°Â·ì¶œë ¥ â€”
r2    = r2_score(y, ridge.predict(X))
alpha = ridge.alpha_
print(f"ì„¤ëª…ë ¥ (RÂ²): {r2:.3f}")
print(f"ìµœì  Î± (alpha): {alpha:.3g}\n")



import plotly.express as px

def make_figure(df, level):
    # 1) scatter - ì‹¤ì œê°€ê²©(xì¶•)ê³¼ ì˜ˆì¸¡ê°€ê²©(yì¶•) ì„¤ì •
    fig = px.scatter(
        df,
        x='SalePrice',     
        y='predicted',     
        color='ridge_flag',
        color_discrete_map={True: 'purple', False: 'lightgray'},
        opacity=0.7,
        title=f"ì‹¤ì œê°€ê²© vs ì˜ˆì¸¡ê°€ê²© ({level}) - Ridge Regression",
        labels={
            'SalePrice': 'ì‹¤ì œê°€ê²©($)',
            'predicted': 'ì˜ˆì¸¡ê°€ê²©($)',
            'ridge_flag': 'í—ˆìœ„ë§¤ë¬¼ ì—¬ë¶€'
        }
    )
    
    # 2) ëŒ€ê°ì„  (y = x)
    mn = min(df['predicted'].min(), df['SalePrice'].min())
    mx = max(df['predicted'].max(), df['SalePrice'].max())
    fig.add_shape(
        type='line',
        x0=mn, y0=mn, x1=mx, y1=mx,
        line=dict(color='black', dash='dash')
    )
    
    # 3) ì¶• ì œëª© & 1:1 ë¹„ìœ¨ ê³ ì • ë° ë²”ë¡€ ê°œì„ 
    fig.update_layout(
        width=650,         
        height=600,
        margin=dict(l=80, r=60, t=80, b=80),
        xaxis=dict(
            title='ì‹¤ì œê°€ê²©',
            scaleanchor='y', 
            scaleratio=1,
            title_standoff=15
        ),
        yaxis=dict(
            title='ì˜ˆì¸¡ê°€ê²©',
            title_standoff=15
        ),
        # 4) ë²”ë¡€ ìœ„ì¹˜ì™€ í˜•ì‹ ê°œì„  ('itemname' ì†ì„± ì œê±°)
        legend=dict(
            title=None,  # ë²”ë¡€ ì œëª© ì œê±°
            yanchor="top",
            y=0.99,
            xanchor="left",
            x=0.01,
            bgcolor="rgba(255, 255, 255, 0.8)",
            bordercolor="Black",
            borderwidth=1,
            font=dict(size=12)
        )
    )
    
    # 5) ë²”ë¡€ í…ìŠ¤íŠ¸ ì§ì ‘ ì—…ë°ì´íŠ¸
    new_names = {'True': 'í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬', 'False': 'ì •ìƒ'}
    fig.for_each_trace(lambda t: t.update(name = new_names[t.name]))
    
    return fig

# ì‚¬ìš©
fig = make_figure(df_lvl, level)
fig
```

### Mid ê·¸ë£¹ í—ˆìœ„ë§¤ë¬¼ ì •ë¦¬

```{python}
# 1) í†µê³„ ê³„ì‚°
flagged = df_lvl[df_lvl['ridge_flag']]
total   = len(df_lvl)
count   = len(flagged)
pct     = count/total*100

# 4) ê²°ê³¼ ì¶œë ¥
print(f"â–¶ ì „ì²´ ìƒ˜í”Œ ìˆ˜: {total}ê°œ")
print(f"â–¶ í—ˆìœ„ë§¤ë¬¼ ìˆ˜: {count}ê°œ ({pct:.1f}%)\n")

```

#### í—ˆìœ„ë§¤ë¬¼ ëª©ë¡ (ì •ë ¬ ê¸°ì¤€ : residual)

```{python}
# 5) ëª©ë¡
flagged[['Neighborhood','SalePrice','predicted','residual']] \
    .sort_values('residual')
```

#### Mid ê·¸ë£¹ í—ˆìœ„ë§¤ë¬¼ ìœ„ì¹˜ ì§€ë„

```{python}

# 1) í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬ë§Œ í•„í„°ë§ (ì´ë¯¸ flaggedì— ì €ì¥ë¨)
suspects = flagged.copy()

# 2) ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
center = {
    "lat": suspects["Latitude"].mean(),
    "lon": suspects["Longitude"].mean()
}

# 3) Mapbox ì‚°ì ë„ ê·¸ë¦¬ê¸°
fig = px.scatter_mapbox(
    suspects,
    lat="Latitude",
    lon="Longitude",
    hover_name="Neighborhood",
    hover_data=["SalePrice","predicted","residual"],
    labels={
        "Latitude": "ìœ„ë„",
        "Longitude": "ê²½ë„",
        "price_level": "ë™ë„¤ ê°€ê²© ìˆ˜ì¤€",
        "Neighborhood": "ì§€ì—­(ë™ë„¤)",
        "SalePrice": "ì‹¤ì œ ê°€ê²©($)",
        "predicted": "ì˜ˆì¸¡ ê°€ê²©($)",
        "residual": "ì”ì°¨(ì‹¤ì œ ê°€ê²© - ì˜ˆì¸¡ ê°€ê²©)"
    },
    color_discrete_sequence=["purple"],
    zoom=11,
    center=center,
    width=600,    # ìº”ë²„ìŠ¤ ê°€ë¡œ(px)
    height=600,    # ìº”ë²„ìŠ¤ ì„¸ë¡œ(px)
    mapbox_style="open-street-map",
)

fig
```

:::

### High ê·¸ë£¹ 

::: {.card}

```{python}

level = 'High'
df_lvl = df[df['price_level'] == level].copy()

X = df_lvl[features]
y = df_lvl[target]
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

ridge = RidgeCV(alphas=np.logspace(-4, 1, 10), cv=5, scoring='neg_mean_squared_error')
ridge.fit(X_train, y_train)

df_lvl['predicted'] = ridge.predict(X)
df_lvl['residual']  = df_lvl['SalePrice'] - df_lvl['predicted']
thresh = df_lvl['residual'].quantile(72/2579)
df_lvl['ridge_flag'] = df_lvl['residual'] <= thresh


#â€” ì„¤ëª…ë ¥(RÂ²) ë° ìµœì  Î± ê³„ì‚°Â·ì¶œë ¥ â€”
r2    = r2_score(y, ridge.predict(X))
alpha = ridge.alpha_
print(f"ì„¤ëª…ë ¥ (RÂ²): {r2:.3f}")
print(f"ìµœì  Î± (alpha): {alpha:.3g}\n")


import plotly.express as px

def make_figure(df, level):
    # 1) scatter - ì‹¤ì œê°€ê²©(xì¶•)ê³¼ ì˜ˆì¸¡ê°€ê²©(yì¶•) ì„¤ì •
    fig = px.scatter(
        df,
        x='SalePrice',     
        y='predicted',     
        color='ridge_flag',
        color_discrete_map={True: 'purple', False: 'lightgray'},
        opacity=0.7,
        title=f"ì‹¤ì œê°€ê²© vs ì˜ˆì¸¡ê°€ê²© ({level}) - Ridge Regression",
        labels={
            'SalePrice': 'ì‹¤ì œê°€ê²©($)',
            'predicted': 'ì˜ˆì¸¡ê°€ê²©($)',
            'ridge_flag': 'í—ˆìœ„ë§¤ë¬¼ ì—¬ë¶€'
        }
    )
    
    # 2) ëŒ€ê°ì„  (y = x)
    mn = min(df['predicted'].min(), df['SalePrice'].min())
    mx = max(df['predicted'].max(), df['SalePrice'].max())
    fig.add_shape(
        type='line',
        x0=mn, y0=mn, x1=mx, y1=mx,
        line=dict(color='black', dash='dash')
    )
    
    # 3) ì¶• ì œëª© & 1:1 ë¹„ìœ¨ ê³ ì • ë° ë²”ë¡€ ê°œì„ 
    fig.update_layout(
        width=650,         
        height=600,
        margin=dict(l=80, r=60, t=80, b=80),
        xaxis=dict(
            title='ì‹¤ì œê°€ê²©',
            scaleanchor='y', 
            scaleratio=1,
            title_standoff=15
        ),
        yaxis=dict(
            title='ì˜ˆì¸¡ê°€ê²©',
            title_standoff=15
        ),
        # 4) ë²”ë¡€ ìœ„ì¹˜ì™€ í˜•ì‹ ê°œì„  ('itemname' ì†ì„± ì œê±°)
        legend=dict(
            title=None,  # ë²”ë¡€ ì œëª© ì œê±°
            yanchor="top",
            y=0.99,
            xanchor="left",
            x=0.01,
            bgcolor="rgba(255, 255, 255, 0.8)",
            bordercolor="Black",
            borderwidth=1,
            font=dict(size=12)
        )
    )
    
    # 5) ë²”ë¡€ í…ìŠ¤íŠ¸ ì§ì ‘ ì—…ë°ì´íŠ¸
    new_names = {'True': 'í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬', 'False': 'ì •ìƒ'}
    fig.for_each_trace(lambda t: t.update(name = new_names[t.name]))
    
    return fig

# ì‚¬ìš©
fig = make_figure(df_lvl, level)
fig
```

### High ê·¸ë£¹ í—ˆìœ„ë§¤ë¬¼ ì •ë¦¬

```{python}
# 1) í†µê³„ ê³„ì‚°
flagged = df_lvl[df_lvl['ridge_flag']]
total   = len(df_lvl)
count   = len(flagged)
pct     = count/total*100

# 4) ê²°ê³¼ ì¶œë ¥
print(f"â–¶ ì „ì²´ ìƒ˜í”Œ ìˆ˜: {total}ê°œ")
print(f"â–¶ í—ˆìœ„ë§¤ë¬¼ ìˆ˜: {count}ê°œ ({pct:.1f}%)\n")

```

#### í—ˆìœ„ë§¤ë¬¼ ëª©ë¡ (ì •ë ¬ ê¸°ì¤€ : residual)

```{python}
# 5) ëª©ë¡
flagged[['Neighborhood','SalePrice','predicted','residual']] \
    .sort_values('residual')
```

#### High ê·¸ë£¹ í—ˆìœ„ë§¤ë¬¼ ìœ„ì¹˜ ì§€ë„

```{python}

# 1) í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬ë§Œ í•„í„°ë§ (ì´ë¯¸ flaggedì— ì €ì¥ë¨)
suspects = flagged.copy()

# 2) ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
center = {
    "lat": suspects["Latitude"].mean(),
    "lon": suspects["Longitude"].mean()
}

# 3) Mapbox ì‚°ì ë„ ê·¸ë¦¬ê¸°
fig = px.scatter_mapbox(
    suspects,
    lat="Latitude",
    lon="Longitude",
    hover_name="Neighborhood",
    hover_data=["SalePrice","predicted","residual"],
    labels={
        "Latitude": "ìœ„ë„",
        "Longitude": "ê²½ë„",
        "price_level": "ë™ë„¤ ê°€ê²© ìˆ˜ì¤€",
        "Neighborhood": "ì§€ì—­(ë™ë„¤)",
        "SalePrice": "ì‹¤ì œ ê°€ê²©($)",
        "predicted": "ì˜ˆì¸¡ ê°€ê²©($)",
        "residual": "ì”ì°¨(ì‹¤ì œ ê°€ê²© - ì˜ˆì¸¡ ê°€ê²©)"
    },
    color_discrete_sequence=["purple"],
    zoom=11,
    center=center,
    width=600,    # ìº”ë²„ìŠ¤ ê°€ë¡œ(px)
    height=600,    # ìº”ë²„ìŠ¤ ì„¸ë¡œ(px)
    mapbox_style="open-street-map",
)

fig
```

:::
