--- 
title: "Ames Housing: í—ˆìœ„ë§¤ë¬¼ íƒì§€ í”„ë¡œì íŠ¸"
author: 'ì¼ë‹¨ì¡1ì¡°(ì†¡ì„±í•„, í™ì£¼í˜•, í¸ì„œì˜, ì–‘í˜„ì¤€)'
format: 
  dashboard:
    theme: sandstone
    scrolling: True
    logo: igotyou.png
    freeze: true
--- 

# 1ì¥

---

```{python}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.linear_model import LassoCV
from sklearn.model_selection import train_test_split
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False
pd.set_option('display.max_columns', None)


# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
ames = pd.read_csv('./ames.csv')

# ë³µì‚¬ ë° ì „ì²˜ë¦¬
df = ames.copy()

df_ns = df.groupby('Neighborhood')['SalePrice'].mean()

# ë¶„ìœ„ìˆ˜ ê³„ì‚°
q1 = df_ns.quantile(0.25)
q2 = df_ns.quantile(0.75)

df['price_level'] = np.select(
    [
        df['Neighborhood'].isin(df_ns[df_ns <= q1].index),
        df['Neighborhood'].isin(df_ns[(df_ns > q1) & (df_ns <= q2)].index),
        df['Neighborhood'].isin(df_ns[df_ns > q2].index)
    ],
    ['Low', 'Mid', 'High'],
    default=np.nan
)

## 2. ëª¨ë“  ë²”ì£¼í˜• ë°ì´í„° ê²°ì¸¡ì¹˜ >> None ì¶”ê°€

# ë²”ì£¼í˜• ì»¬ëŸ¼ë§Œ ì„ íƒ
cat_cols = df.select_dtypes(include='object').columns

# ë²”ì£¼í˜• ê²°ì¸¡ì¹˜ 'None'ìœ¼ë¡œ ëŒ€ì²´
df[cat_cols] = df[cat_cols].fillna('None')


df['amenities'] = (
    (df['PoolArea'] > 0).astype(int) +
    (df['TotalBsmtSF'] > 0).astype(int) +
    (df['GarageArea'] > 0).astype(int) + 
    (df['MiscVal'] > 0).astype(int)
)

df['TotalRooms'] = df['TotRmsAbvGrd'] + df['HalfBath'] + df['FullBath']  # ìš•ì‹¤ ì œì™¸ ë°©ìˆ˜ + ë°˜ìš•ì‹¤ + í’€ìš•ì‹¤
df['RoomDensity'] = df['TotalRooms'] / df['GrLivArea']  # ë°© ë°€ë„ (ë°©ìˆ˜ / ê±°ì‹¤ ë©´ì )

## 3. í—ˆìœ„ë§¤ë¬¼ íŒë‹¨ ì¡°ê±´ ì„¤ì • - ê¸°ì¤€ê°’ ìƒìœ„ 25% ì´ìƒ
df['GrLivArea_th']    = df.groupby('price_level')['GrLivArea']   \
                           .transform(lambda x: x.quantile(0.75))
df['YearRemodAdd_th'] = df.groupby('price_level')['YearRemodAdd']\
                           .transform(lambda x: x.quantile(0.75))
df['RoomDensity_th']  = df.groupby('price_level')['RoomDensity'] \
                           .transform(lambda x: x.quantile(0.75))


# ì§€ì—­ë“¤ ë¶„ë¦¬í•˜ëŠ” df ìƒì„±
high_df = df[df['price_level'] == 'High'].copy()
mid_df  = df[df['price_level'] == 'Mid'].copy()
low_df  = df[df['price_level'] == 'Low'].copy()

```

# 2ì¥

## Columns

<div style="border: 2px solid #DC143C; border-radius: 15px; padding: 15px; background-color: #fff5f5;">
  <span style="font-size: 25px; font-weight: bold; color: #DC143C;">
    ğŸ“Œ ë¶„ì„ ê³¼ì •
  </span><br><br>
  6ê°€ì§€ ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ê³ , 3ì  ì´ìƒì— í•´ë‹¹ë˜ëŠ” í—ˆìœ„ë§¤ë¬¼ì„ ì¶”ì¶œí•œë‹¤. <br>
  ì´í›„ íšŒê·€ ëª¨ë¸ì„ í†µí•´ í—ˆìœ„ë§¤ë¬¼ì„ ì¶”ì¶œí•œ ë’¤, ê³µí†µ í—ˆìœ„ë§¤ë¬¼ì„ ì¶”ì¶œí•œë‹¤.
  <br><br>

</div>

## Row
:::{.card} 
<span style="font-size: 35px;">
ğŸ˜ ê°€ê²© ë³„ ê·¸ë£¹ ë¶„ë¥˜
</span>

```{python}
# ê°€ê²© ìˆ˜ì¤€ë³„ SalePrice ë¶„í¬
import plotly.express as px
fig = px.histogram(df, x='SalePrice', 
                    color='price_level', 
                    opacity=0.6)
fig.show()

```

:::

## Row {.tabset}
:::{.card}
```{python}
# ê·¸ë£¹ë³„ ì‹œê°í™” : ë°•ìŠ¤í”Œë¡¯
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# ì„œë¸Œí”Œë¡¯ ìƒì„± (ê°€ë¡œë¡œ 3ê°œ)
fig1 = make_subplots(rows=1, cols=3, subplot_titles=("GrLivArea by Price Level", 
                                                    "YearRemodAdd by Price Level", 
                                                    "RoomDensity by Price Level"))

# GrLivArea
for level in df['price_level'].unique():
    fig1.add_trace(
        go.Box(y=df[df['price_level'] == level]['GrLivArea'],
               name=level,
               boxmean=True),
        row=1, col=1
    )
# YearRemodAdd
for level in df['price_level'].unique():
    fig1.add_trace(
        go.Box(y=df[df['price_level'] == level]['YearRemodAdd'],
               name=level,
               boxmean=True),
        row=1, col=2
    )
# RoomDensity
for level in df['price_level'].unique():
    fig1.add_trace(
        go.Box(y=df[df['price_level'] == level]['RoomDensity'],
               name=level,
               boxmean=True),
        row=1, col=3
    )

# ì „ì²´ ë ˆì´ì•„ì›ƒ ì„¤ì •
fig1.update_layout(
    height=500, width=1200,
    showlegend=False
)

fig1.show();
```

<span style="font-size: 25px;">
  âœ”**GrLivArea** : ì§€ìƒì¸µ ë©´ì  <br>
  âœ”**YearRemodAdd** : ë¦¬ëª¨ë¸ë§ <br>
  âœ”**RoomDensity** : ë°© ë°€ë„ (ë°©ìˆ˜/ë©´ì )
<span>

:::

:::{.card}
```{python}
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# ì„œë¸Œí”Œë¡¯ ìƒì„±: 3í–‰ 3ì—´
fig2 = make_subplots(
    rows=3, cols=3,
    subplot_titles=[
        'OverallQual - Low', 'OverallQual - Mid', 'OverallQual - High',
        'OverallCond - Low', 'OverallCond - Mid', 'OverallCond - High',
        'Amenities - Low', 'Amenities - Mid', 'Amenities - High'
    ]
)
# ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ ë° ì‹œê°í™” ì„¸íŒ…
variables = ['OverallQual', 'OverallCond', 'amenities']
colors = ['skyblue', 'salmon', 'lightgreen']
bins_dict = {
    'OverallQual': list(range(1, 11)),
    'OverallCond': list(range(1, 11)),
    'amenities': list(range(0, 6))
}
# ê·¸ë˜í”„ ì¶”ê°€
for row, var in enumerate(variables, start=1):
    for col, level in enumerate(['Low', 'Mid', 'High'], start=1):
        subset = df[df['price_level'] == level]
        fig2.add_trace(
            go.Histogram(
                x=subset[var],
                xbins=dict(
                    start=min(bins_dict[var]),
                    end=max(bins_dict[var]),
                    size=1
                ),
                marker_color=colors[row-1],
                name=f'{var} - {level}',
                showlegend=False
            ),
            row=row, col=col
        )
# ì „ì²´ ë ˆì´ì•„ì›ƒ ì¡°ì •
fig2.update_layout(
    height=900, width=1000,
    bargap=0.1
)

fig2.show();

```

<span style="font-size: 25px;">
  âœ”**OverallQual** : ì§€ìƒì¸µ ë©´ì  <br>
  âœ”**OverallCond** : ë¦¬ëª¨ë¸ë§ <br>
  âœ”**Amenities** : ë°© ë°€ë„ (ë°©ìˆ˜/ë©´ì )
</span>

:::

## Row

```{python}
# High ê·¸ë£¹
high_med      = high_df['SalePrice'].median()
high_area_th  = high_df['GrLivArea'].quantile(0.75)
high_remod_th = high_df['YearRemodAdd'].quantile(0.75)
high_den_th   = high_df['RoomDensity'].quantile(0.75)

high_df['flag_high_qual']      = (high_df['OverallQual']  >= 9).astype(int)
high_df['flag_good_condition'] = (high_df['OverallCond']  >= 6).astype(int)
high_df['flag_high_area']      = (high_df['GrLivArea']    >= high_area_th ).astype(int)
high_df['flag_high_remod']     = (high_df['YearRemodAdd'] >= high_remod_th).astype(int)
high_df['flag_high_density']   = (high_df['RoomDensity']  >= high_den_th  ).astype(int)
high_df['flag_high_amenities'] = (high_df['amenities']    >= 3            ).astype(int)

# Mid ê·¸ë£¹
mid_med      = mid_df['SalePrice'].median()
mid_area_th  = mid_df['GrLivArea'].quantile(0.75)
mid_remod_th = mid_df['YearRemodAdd'].quantile(0.75)
mid_den_th   = mid_df['RoomDensity'].quantile(0.75)

mid_df['flag_mid_qual']        = (mid_df['OverallQual']  >= 8).astype(int)
mid_df['flag_good_condition']  = (mid_df['OverallCond']  >= 6).astype(int)
mid_df['flag_mid_area']        = (mid_df['GrLivArea']    >= mid_area_th ).astype(int)
mid_df['flag_mid_remod']       = (mid_df['YearRemodAdd'] >= mid_remod_th).astype(int)
mid_df['flag_mid_density']     = (mid_df['RoomDensity']  >= mid_den_th  ).astype(int)
mid_df['flag_mid_amenities']   = (mid_df['amenities']    >= 3            ).astype(int)

# Low ê·¸ë£¹
low_med      = low_df['SalePrice'].median()
low_area_th  = low_df['GrLivArea'].quantile(0.75)
low_remod_th = low_df['YearRemodAdd'].quantile(0.75)
low_den_th   = low_df['RoomDensity'].quantile(0.75)

low_df['flag_low_qual']        = (low_df['OverallQual']  >= 7).astype(int)
low_df['flag_good_condition']  = (low_df['OverallCond']  >= 8).astype(int)
low_df['flag_low_area']        = (low_df['GrLivArea']    >= low_area_th ).astype(int)
low_df['flag_low_remod']       = (low_df['YearRemodAdd'] >= low_remod_th).astype(int)
low_df['flag_low_density']     = (low_df['RoomDensity']  >= low_den_th  ).astype(int)
low_df['flag_low_amenities']   = (low_df['amenities']    >= 3            ).astype(int)

for name, gdf, med in [
    ('High', high_df, high_med),
    ('Mid',  mid_df,  mid_med),
    ('Low',  low_df,  low_med),
]:
    # Median ì´í•˜ì¸ ë§¤ë¬¼ë§Œ ë³µì‚¬ë³¸ìœ¼ë¡œ
    filt = gdf.loc[gdf['SalePrice'] <= med].copy()
    
    # ì´ ê·¸ë£¹ì˜ flag ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸
    flags = [c for c in filt.columns 
             if c.startswith(f'flag_{name.lower()}') or c == 'flag_good_condition']

# (1) score ê³„ì‚°: 6ê°€ì§€ ì¡°ê±´ì„ í•œ ì¤„ë¡œ ì§‘ê³„
qual_th = {'Low':7,'Mid':8,'High':9}
cond_th = {'Low':8,'Mid':6,'High':6}

df['score'] = df.apply(lambda r: 
    int(r['OverallQual']  >= qual_th[r['price_level']]) +
    int(r['OverallCond']  >= cond_th [r['price_level']]) +
    int(r['GrLivArea']    >= r['GrLivArea_th']) +
    int(r['YearRemodAdd'] >= r['YearRemodAdd_th']) +
    int(r['RoomDensity']  >= r['RoomDensity_th']) +
    int(r['amenities']    >= 3),
    axis=1
)

# (2) ê·¸ë£¹ë³„ ì¤‘ìœ„ê°’ ì´í•˜ ì—¬ë¶€
median_price = df.groupby('price_level')['SalePrice'].transform('median')

# (3) suspect_flag ìƒì„±
df['suspect_flag'] = (df['SalePrice'] <= median_price) & (df['score'] >= 3)

# (4) í—ˆìœ„ë§¤ë¬¼ í›„ë³´ë§Œ ì¶”ì¶œ
suspect_df = df[df['suspect_flag']].copy()


```

```{python}
from IPython.display import display, HTML

html_table = """
<div style="display: flex; flex-direction: row; gap: 20px; justify-content: space-between;">
  <div style="width: 33%; padding: 10px; border: 2px solid #4CAF50; border-radius: 15px; background-color: #e8f5e9;">
    <span style="font-size: 32px; font-weight: bold; color: #4CAF50;">ğŸ“Š **High ê·¸ë£¹ ë¶„ì„**</span>
    <br><br>
    <strong style="font-size: 24px;">ì¡°ê±´ í”Œë˜ê·¸:</strong><br>
    <ul style="font-size: 20px;">
      <li>flag_high_qual: 3</li>
      <li>flag_good_condition: 22</li>
      <li>flag_high_area: 10</li>
      <li>flag_high_remod: 76</li>
      <li>flag_high_density: 93</li>
      <li>flag_high_amenities: 3</li>
    </ul>
    <br>
    <strong style="font-size: 24px;">Score ë¶„í¬:</strong><br>
    <ul style="font-size: 20px;">
      <li>0: 76</li>
      <li>1: 103</li>
      <li>2: 47</li>
      <li>3: 2</li>
      <li>4: 1</li>
    </ul>
    <br>
    <strong style="font-size: 24px;">Score â‰¥ 3ì¸ ê±´ìˆ˜: 3ê±´</strong>
  </div>

  <div style="width: 33%; padding: 10px; border: 2px solid #2196F3; border-radius: 15px; background-color: #e3f2fd;">
    <span style="font-size: 32px; font-weight: bold; color: #2196F3;">ğŸ“Š **Mid ê·¸ë£¹ ë¶„ì„**</span>
    <br><br>
    <strong style="font-size: 24px;">ì¡°ê±´ í”Œë˜ê·¸:</strong><br>
    <ul style="font-size: 20px;">
      <li>flag_mid_qual: 2</li>
      <li>flag_good_condition: 366</li>
      <li>flag_mid_area: 53</li>
      <li>flag_mid_remod: 107</li>
      <li>flag_mid_density: 296</li>
      <li>flag_mid_amenities: 37</li>
    </ul>
    <br>
    <strong style="font-size: 24px;">Score ë¶„í¬:</strong><br>
    <ul style="font-size: 20px;">
      <li>0: 158</li>
      <li>1: 348</li>
      <li>2: 172</li>
      <li>3: 51</li>
      <li>4: 4</li>
    </ul>
    <br>
    <strong style="font-size: 24px;">Score â‰¥ 3ì¸ ê±´ìˆ˜: 55ê±´</strong>
  </div>

  <div style="width: 33%; padding: 10px; border: 2px solid #FF5722; border-radius: 15px; background-color: #ffebee;">
    <span style="font-size: 32px; font-weight: bold; color: #FF5722;">ğŸ“Š **Low ê·¸ë£¹ ë¶„ì„**</span>
    <br><br>
    <strong style="font-size: 24px;">ì¡°ê±´ í”Œë˜ê·¸:</strong><br>
    <ul style="font-size: 20px;">
      <li>flag_low_qual: 4</li>
      <li>flag_good_condition: 30</li>
      <li>flag_low_area: 24</li>
      <li>flag_low_remod: 59</li>
      <li>flag_low_density: 131</li>
      <li>flag_low_amenities: 10</li>
    </ul>
    <br>
    <strong style="font-size: 24px;">Score ë¶„í¬:</strong><br>
    <ul style="font-size: 20px;">
      <li>0: 133</li>
      <li>1: 155</li>
      <li>2: 30</li>
      <li>3: 13</li>
      <li>4: 1</li>
    </ul>
    <br>
    <strong style="font-size: 24px;">Score â‰¥ 3ì¸ ê±´ìˆ˜: 14ê±´</strong>
  </div>
</div>
"""

display(HTML(html_table))

```

# 3ì¥

## Row {height=30%}
### {width=50%}

<div style="border: 2px solid #DC143C; border-radius: 15px; padding: 15px; background-color: #fff5f5;">
  <span style="font-size: 25px; font-weight: bold; color: #DC143C;">
    â— ì¡°ê±´ í”Œë˜ê·¸ ê²°ê³¼
  </span><br><br>
  72ê±´ì˜ í—ˆìœ„ë§¤ë¬¼ ì˜ì‹¬ í›„ë³´ ì¶”ì¶œ <br>
  ìš°ì¸¡ ì§€ë„ë¥¼ í†µí•´ ê·¸ë£¹ë³„ í—ˆìœ„ë§¤ë¬¼ ë¶„í¬ í™•ì¸ ê°€ëŠ¥í•¨
  <br><br>

</div>


### {width=50%}

```{python}
import plotly.express as px

center = {
    "lat": suspect_df["Latitude"].mean(),
    "lon": suspect_df["Longitude"].mean()
}

fig = px.scatter_mapbox(
    suspect_df,
    lat="Latitude",
    lon="Longitude",
    color="price_level",
    size="SalePrice",  # ë§ˆì»¤ í¬ê¸°ë¥¼ íŒë§¤ ê°€ê²©ì— ë”°ë¼ ì„¤ì •
    hover_name="Neighborhood",
    hover_data=["SalePrice", "GrLivArea"],
    labels={
        "Latitude": "ìœ„ë„",
        "Longitude": "ê²½ë„",
        "price_level": "ë™ë„¤ ê°€ê²© ìˆ˜ì¤€",
        "Neighborhood": "ì§€ì—­(ë™ë„¤)",
        "SalePrice": "íŒë§¤ ê°€ê²©($)",
        "GrLivArea": "ê±°ì‹¤ ë©´ì (ftÂ²)"
    },
    zoom=12,                    
    center=center,              
    height=600,
    mapbox_style="open-street-map",
    title="Ames Housing: Price Level by Neighborhood (í™•ëŒ€)"
)

fig.show()

```

## Row {height=20%}
### {width=30%}






### {width=70%}


